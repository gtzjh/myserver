# Ubuntu/Debian 系统初始化脚本

专为Ubuntu/Debian系统设计的自动化初始化配置脚本，提供国内优化配置和Docker环境部署。

## 主要功能

1. **系统配置**
   - 交互式时区设置（支持IP自动检测+手动选择）
   - APT镜像源选择（USTC/清华/阿里云/官方源）
   - 系统更新升级
   - 禁用休眠模式（Debian系专用）

2. **包管理优化**
   - 完全移除Snap及其相关组件
   - 配置国内APT镜像源
   - 阻止Snap自动安装
   - 基础工具自动安装（curl/vim/git/ping等）

3. **Docker环境部署**
   - 智能安装策略（自动选择国内/国际源）
   - 双镜像源故障转移（USTC/Official）
   - 注册表镜像自动检测（20+国内镜像源）
   - 安装后验证（服务状态/版本检查/测试容器）
   - 旧组件自动清理

4. **错误处理机制**
   - 分步错误日志记录 (error.log)
   - 网络操作自动重试（最大6次）
   - APT源更新失败自动回滚
   - Docker服务异常日志输出
   - 关键配置自动备份（sources.list等）

## 新增功能亮点

- Docker镜像加速器智能检测（自动选择最快镜像）
- 硬件时钟自动同步（WSL环境自动跳过）
- 时区设置三重模式（保持/自动检测/手动）
- 安装失败安全回滚（Docker/Snap移除）
- 系统资源预检查（磁盘空间/内核版本）

## 系统要求

- Ubuntu 20.04 LTS 或更高版本（其余版本测试中）
- Root权限
- 网络连接
- 1GB 可用磁盘空间
- 内核版本 5.10+

## 使用说明

1. 下载脚本：
   ```bash
   wget https://raw.githubusercontent.com/gtzjh/myserver/main/init.sh
   ```

2. 添加执行权限：
   ```bash
   chmod +x init.sh
   ```

3. 以root权限运行：
   ```bash
   sudo ./init.sh
   ```


## 交互配置项

脚本运行时会提示：
1. 时区配置选项（保持当前/自动检测/手动选择）
2. APT镜像源选择（USTC/清华/阿里云/保持默认）
3. 确认是否移除Snap
4. 是否安装Docker运行时

## 安全特性

新增：
- 镜像源GPG签名强制验证
- Docker安装脚本完整性检查
- 临时下载文件自动清理
- 敏感操作前创建系统快照（需要LVM支持）
- 网络超时限制（所有下载操作）

## 错误处理

- 网络安装失败自动重试3次
- APT源更新失败自动回滚
- Docker服务异常时输出日志
- 关键步骤失败中止后续流程

## 注意事项

1. **Docker相关**
   - 安装后需手动注销重新登录才能使用非root权限
   - 测试容器需要访问docker.io
   - 阿里云镜像需要公网访问权限

2. **系统限制**
   - 仅适用于Ubuntu系统
   - WSL环境自动跳过硬件时钟同步
   - 低内存设备可能无法运行测试容器

3. **镜像加速器**
   - 自动选择前6个可用镜像
   - 包含备用镜像保障可用性
   - 配置后需等待6秒服务重启

4. **系统要求**
   - 内核版本需≥5.10（WSL2已预装）
   - 测试容器需要1GB可用内存
   - 阿里云镜像需要AccessKey权限

5. **网络要求**
   - Docker官方安装脚本需要访问GitHub
   - 测试容器需要连接dockerhub
   - 企业内网需放行mirrors.ustc.edu.cn
